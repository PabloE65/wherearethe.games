<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Showcase</title>
    <link href="main.css" rel="stylesheet">
</head>

<body>
    <div id="filterButtons"></div>
    <div class="container" id="gameContainer"></div>

    <script>
        // Function to fetch and parse CSV data
        let allGames = [];  // Global variable to store all games

        let uniqueCountries = new Set(); // This will store unique countries
        // Add new countries to the set
        uniqueCountries.add('Chile');
        uniqueCountries.add('Denmark');

        async function fetchCSVData(url) {
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                return parseCSV(csvText);
            } catch (error) {
                console.error('Error fetching CSV:', error);
                return [];
            }
        }

        // Function to parse CSV text into an array of objects
        function parseCSV(csvText) {
            const rows = csvText.split('\n');
            const headers = rows[0].split(';;');
            return rows.slice(1).map(row => {
                const values = row.split(';;');
                return headers.reduce((obj, header, index) => {
                    obj[header.trim()] = values[index]?.trim() || '';
                    return obj;
                }, {});
            });
        }

        // Function to create filter buttons
        function createFilterButtons() {
            const filterContainer = document.getElementById('filterButtons');
            filterContainer.innerHTML = '<button onclick="filterGames(\'all\')">All Countries</button>';
            uniqueCountries.forEach(country => {
                filterContainer.innerHTML += `<button onclick="filterGames('${country}')">${country}</button>`;
            });
        }

        createFilterButtons();

        // Function to filter games
        function filterGames(country) {
            if (country === 'all') {
                renderGames(allGames);
            } else {
                const filteredGames = allGames.filter(game => game.Country === country);
                renderGames(filteredGames);
            }
        }

        // Function to create a game card HTML
        function createGameCard(game) {
            return `
                <div class="game-card">
                    <div class="game-header">${game.Name}</div>
                    <img src="${game.Thumbnail}" alt="${game.Name} Thumbnail" class="game-thumbnail">
                    <div class="game-info">
                        <div class="info-item">
                            <span class="info-label">Country</span>
                            ${game.Country}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Genre</span>
                            <span class="genre">${game.Genre}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Description</span>
                            <div class="description">
                                ${game.Description}
                                <span class="read-more">Read More</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Publisher</span>
                            ${game.Publisher_Names}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Developer</span>
                            ${game.Developer_Names}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Platform</span>
                            ${game.Platform}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Release Date</span>
                            ${game.Release_Date}
                        </div>
                        <a href="${game.Steam_Link}" class="steam-link" target="_blank">View on Steam</a>
                    </div>
                </div>
            `;
        }

        // Function to render games
        function renderGames(gamesData) {
            const container = document.getElementById('gameContainer');
            container.innerHTML = ''; // Clear existing content
            gamesData.forEach(game => {
                container.innerHTML += createGameCard(game);
            });

            // Add event listeners for "Read More" buttons
            document.querySelectorAll('.read-more').forEach(button => {
                button.addEventListener('click', function () {
                    this.parentElement.classList.toggle('expanded');
                    this.textContent = this.parentElement.classList.contains('expanded') ? 'Read Less' : 'Read More';
                });
            });
        }

        // Function to filter games based on selected country
        function filterGames(country) {
            if (country === 'all') {
                renderGames(allGames);  // Show all games if "All Countries" is selected
            } else {
                const filteredGames = allGames.filter(game => game.Country === country);
                renderGames(filteredGames);  // Show only filtered games
            }
        }


        // Main function to fetch data and render games
        async function main() {
            const csvUrls = [
                'https://raw.githubusercontent.com/jdiaz97/steamscraper/main/export/Chile.csv',
                'https://raw.githubusercontent.com/jdiaz97/steamscraper/main/export/Denmark.csv',
                // Add more URLs as needed
            ];

            try {
                const gamesData = await fetchMultipleCSVData(csvUrls);
                allGames = gamesData;  // Store all fetched games in a global variable

                renderGames(gamesData);
            } catch (error) {
                console.error('Error fetching or processing data:', error);
            }
        }

        async function fetchMultipleCSVData(urls) {
            const fetchPromises = urls.map(url => fetchCSVData(url));
            const results = await Promise.all(fetchPromises);
            return results.flat();
        }

        async function fetchCSVData(url) {
            const response = await fetch(url);
            const csvText = await response.text();
            return parseCSV(csvText);
        }

        // Call the main function when the page loads
        window.onload = main;
    </script>
</body>

</html>